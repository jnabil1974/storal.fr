open<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flux de Conversation - Chatbot Storal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        
        .phase {
            margin: 30px 0;
            padding: 25px;
            border-radius: 15px;
            position: relative;
        }
        
        .phase-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .phase-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .phase-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        .phase-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; }
        
        .phase-header {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .phase-number {
            background: rgba(255,255,255,0.3);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.2em;
        }
        
        .step {
            background: rgba(255,255,255,0.15);
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid rgba(255,255,255,0.5);
        }
        
        .step-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        
        .step-content {
            font-size: 0.95em;
            line-height: 1.6;
            opacity: 0.95;
        }
        
        .decision-box {
            background: rgba(255,255,255,0.25);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px dashed rgba(255,255,255,0.6);
        }
        
        .decision-title {
            font-weight: bold;
            font-size: 1.15em;
            margin-bottom: 12px;
            text-transform: uppercase;
        }
        
        .decision-options {
            margin-left: 20px;
        }
        
        .option {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            border-left: 3px solid rgba(255,255,255,0.7);
        }
        
        .arrow {
            text-align: center;
            font-size: 2em;
            color: #95a5a6;
            margin: 10px 0;
        }
        
        .highlight {
            background: rgba(255,255,255,0.3);
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .warning {
            background: rgba(255,193,7,0.3);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .success {
            background: rgba(76,175,80,0.3);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4caf50;
            margin: 15px 0;
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9em;
        }
        
        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            margin-right: 10px;
        }
        
        @media print {
            body {
                background: white;
                padding: 20px;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Flux de Conversation - Chatbot Storal</h1>
        <p class="subtitle">Diagramme complet du processus de configuration d'un store banne</p>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                <span><strong>Phase 1:</strong> Environnement (Diagnostic)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                <span><strong>Phase 2:</strong> Validation du Projet</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
                <span><strong>Phase 3:</strong> Esth√©tique (Style)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
                <span><strong>Phase 4:</strong> R√©capitulatif & Offre</span>
            </div>
        </div>

        <!-- PHASE 1 -->
        <div class="phase phase-1">
            <div class="phase-header">
                <div class="phase-number">1</div>
                <div>PHASE 1 : ENVIRONNEMENT (Le Diagnostic Technique)</div>
            </div>
            
            <div class="step">
                <div class="step-title">üìê √âTAPE 1A - DIMENSIONS</div>
                <div class="step-content">
                    Question : "Quelles sont les dimensions de votre espace ? (Largeur √ó D√©ploiement du store (avanc√©e))"
                    <br>‚Üí D√©duction 30cm si dimensions de TERRASSE (pas si dimensions de STORE)
                    <br>‚Üí Si largeur > 6.80m : Proposition d'optimiser √† 6m (budget avantageux)
                </div>
            </div>
            
            <div class="decision-box">
                <div class="decision-title">‚ö†Ô∏è √âTAPE 1A-BIS - VALIDATION MOD√àLE PR√â-S√âLECTIONN√â (CRITIQUE)</div>
                <div class="decision-options">
                    <div class="option">
                        <strong>‚úÖ SI MOD√àLE MENTIONN√â AU D√âPART</strong> (ex: "Je veux un KISSIMY")
                        <br>1. Identifier le mod√®le + son type (coffre/monobloc/traditionnel)
                        <br>2. Consulter largeur max et avanc√©e max
                        <br>3. Comparer avec dimensions demand√©es
                        <br><br>
                        <div class="warning">
                            <strong>üìè Si √©cart < 50cm :</strong> Proposer d'ajuster OU changer
                            <br>"Vous demandez Xm, max possible Y.YYm. √âcart = Zcm."
                            <br>‚Ä¢ Option 1 : Conserver et ajuster √† Y.YYm
                            <br>‚Ä¢ Option 2 : Voir mod√®les alternatifs (M√äME TYPE uniquement)
                        </div>
                        <div class="warning">
                            <strong>‚ùå Si √©cart ‚â• 50cm :</strong> Proposer directement des alternatives (M√äME TYPE)
                        </div>
                        <div class="success">
                            <strong>‚úÖ Si compatible :</strong> Confirmer et continuer
                        </div>
                    </div>
                    <div class="option">
                        <strong>‚û°Ô∏è SI AUCUN MOD√àLE MENTIONN√â</strong>
                        <br>Continuer normalement √† l'√âTAPE 1B
                    </div>
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">üìå √âTAPE 1B - OBSTACLES</div>
                <div class="step-content">
                    "Y a-t-il des obstacles (mur, arbre, poteau) ?" (Oui/Non)
                    <br>‚Üí Si dimensions > 6m √ó 4m : V√©rification PR√âCISE
                    <br>‚Üí Adapter rectangle si obstacles pr√©sents
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">üß≠ √âTAPE 1C - ORIENTATION & RISQUES</div>
                <div class="step-content">
                    "Vers quelle direction : Nord, Sud, Est ou Ouest ?"
                    <br>‚Üí Si Ouest/Est : Recommander Lambrequin Enroulable
                    <br>‚Üí "√ätes-vous en bord de mer ?" (Certifications Qualimarine/Qualicoat)
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">üìè √âTAPE 1D - HAUTEUR & √âLECTRICIT√â</div>
                <div class="step-content">
                    "√Ä quelle hauteur souhaitez-vous installer le store ?"
                    <br>"De quel c√¥t√© la sortie de c√¢ble √©lectrique ? (Gauche/Droite)"
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">üí° √âTAPE 1E - √âCLAIRAGE</div>
                <div class="step-content">
                    "Pensez-vous utiliser le store le soir ?"
                    <br>‚Üí Si oui : Proposer LED Bras ou LED Coffre
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">üí≥ √âTAPE 1F - POSE & TVA</div>
                <div class="step-content">
                    "Installation par vous-m√™me ou nos experts ?"
                    <br>‚Üí Si maison > 2 ans + pose Storal : TVA 10% (au lieu de 20%)
                </div>
            </div>
        </div>

        <div class="arrow">‚¨áÔ∏è</div>

        <!-- PHASE 2 -->
        <div class="phase phase-2">
            <div class="phase-header">
                <div class="phase-number">2</div>
                <div>PHASE 2 : VALIDATION DU PROJET (Le Verrouillage)</div>
            </div>
            
            <div class="step">
                <div class="step-title">üìã R√âCAPITULATIF TECHNIQUE</div>
                <div class="step-content">
                    Afficher un r√©sum√© complet :
                    <br>‚Ä¢ Dimensions (largeur √ó d√©ploiement du store (avanc√©e))
                    <br>‚Ä¢ Orientation & Environnement
                    <br>‚Ä¢ Hauteur de pose & Sortie c√¢ble
                    <br>‚Ä¢ Options : LED, Pose Storal, TVA
                    <br><br>
                    <span class="highlight">‚ö†Ô∏è NE PAS mentionner de mod√®le sp√©cifique ici</span>
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">‚úÖ QUESTION DE VALIDATION</div>
                <div class="step-content">
                    "Ce diagnostic technique vous semble-t-il complet pour passer √† la personnalisation ?"
                    <br>‚Üí Si NON : Reposer les questions n√©cessaires
                    <br>‚Üí Si OUI : Passer √† PHASE 3
                </div>
            </div>
        </div>

        <div class="arrow">‚¨áÔ∏è</div>

        <!-- PHASE 3 -->
        <div class="phase phase-3">
            <div class="phase-header">
                <div class="phase-number">3</div>
                <div>PHASE 3 : ESTH√âTIQUE (Le Style)</div>
            </div>
            
            <div class="decision-box">
                <div class="decision-title">‚ö†Ô∏è D√âTECTION PR√âALABLE RENFORC√âE (3 CAS POSSIBLES)</div>
                <div class="decision-options">
                    <div class="option">
                        <strong>CAS A - Mod√®le VALID√â en √âTAPE 1A-BIS</strong>
                        <br>Le client a mentionn√© un mod√®le ET accept√© le r√©sultat de la v√©rification dimensions
                        <br>R√©ponses positives : "Oui", "Oui √ßa me va", "D'accord", "Option 1", etc.
                        <br><br>
                        <div class="success">
                            <strong>‚Üí ACTION :</strong> SKIP compl√®tement <span class="highlight">open_model_selector</span>
                            <br>‚Üí Passer DIRECTEMENT √† <span class="highlight">open_color_selector</span>
                            <br>Le mod√®le est d√©j√† finalis√©, inutile de proposer des alternatives ‚úÖ
                        </div>
                    </div>
                    
                    <div class="option">
                        <strong>CAS B - Mod√®le mentionn√© MAIS pas valid√©</strong>
                        <br>Mod√®le cit√© mais √âTAPE 1A-BIS pas franchie OU client a choisi "Option 2"
                        <br><br>
                        <div class="warning">
                            <strong>‚Üí ACTION :</strong> SKIP questions Type/Design
                            <br>‚Üí APPELER <span class="highlight">open_model_selector</span> avec :
                            <br>&nbsp;&nbsp;‚Ä¢ Ce mod√®le mentionn√©
                            <br>&nbsp;&nbsp;‚Ä¢ + 2 alternatives du M√äME TYPE (coffre/monobloc/traditionnel)
                        </div>
                    </div>
                    
                    <div class="option">
                        <strong>CAS C - Aucun mod√®le mentionn√©</strong>
                        <br>Le client arrive sans pr√©-s√©lection de mod√®le
                        <br><br>
                        <strong>‚Üí ACTION :</strong>
                        <br>1. Poser questions "Type de store ?" et "Design ?"
                        <br>2. APPELER <span class="highlight">open_model_selector</span> avec 3 mod√®les compatibles
                    </div>
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">üé® √âTAPE 3A - COULEUR ARMATURE</div>
                <div class="step-content">
                    APPELER <span class="highlight">open_color_selector</span> pour afficher les pastilles RAL
                    <br>‚Üí NE JAMAIS d√©crire les couleurs en texte
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">üé® √âTAPE 3B - CHOIX TOILE</div>
                <div class="step-content">
                    APPELER <span class="highlight">open_fabric_selector</span> pour afficher les toiles disponibles
                    <br>‚Üí NE JAMAIS d√©crire les toiles en texte
                </div>
            </div>
        </div>

        <div class="arrow">‚¨áÔ∏è</div>

        <!-- PHASE 4 -->
        <div class="phase phase-4">
            <div class="phase-header">
                <div class="phase-number">4</div>
                <div>PHASE 4 : R√âCAPITULATIF & OFFRE (La Conclusion)</div>
            </div>
            
            <div class="step">
                <div class="step-title">üìã R√âCAPITULATIF COMPLET</div>
                <div class="step-content">
                    Afficher TOUS les choix du client :
                    <br>‚Ä¢ Mod√®le + Dimensions
                    <br>‚Ä¢ Couleurs (armature + toile)
                    <br>‚Ä¢ Options (LED, Lambrequin, Auvent, etc.)
                    <br>‚Ä¢ Pose + TVA
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">‚úÖ VALIDATION FINALE</div>
                <div class="step-content">
                    "Est-ce que cette configuration correspond exactement √† votre projet ?"
                    <br>‚Üí Si NON : Ajuster les √©l√©ments n√©cessaires
                    <br>‚Üí Si OUI : G√©n√©rer le devis personnalis√©
                </div>
            </div>
            
            <div class="decision-box">
                <div class="decision-title">üí∞ G√âN√âRATION DU DEVIS PERSONNALIS√â</div>
                <div class="step-content">
                    APPELER <span class="highlight">display_single_offer</span> (1 SEULE offre)
                    <br><br>
                    <strong>Contenu du devis :</strong>
                    <br>‚Ä¢ Prix de base du store (HT)
                    <br>‚Ä¢ + Prix des options choisies par le client (LED, Lambrequin, etc.)
                    <br>‚Ä¢ + Pose (si choisie)
                    <br>‚Ä¢ + TVA (10% ou 20%)
                    <br>‚Ä¢ = PRIX TOTAL TTC
                    <br><br>
                    <span class="highlight">‚ö†Ô∏è NE PLUS proposer 3 offres (Eco/Standard/Premium)</span>
                    <br>Afficher UNIQUEMENT ce que le client a demand√© ‚úÖ
                </div>
            </div>
            
            <div class="step">
                <div class="step-title">üîÑ SI CLIENT VEUT MODIFIER</div>
                <div class="step-content">
                    Si "c'est trop cher" ou "je veux enlever X" :
                    <br>‚Üí Proposer de retirer des options (LED, Lambrequin)
                    <br>‚Üí Recalculer et afficher nouveau devis
                    <br>‚Üí NE PAS changer de type de store sauf si demand√© explicitement
                </div>
            </div>
        </div>

        <div style="margin-top: 40px; padding: 30px; background: #ecf0f1; border-radius: 15px; text-align: center;">
            <h2 style="color: #2c3e50; margin-bottom: 15px;">üéØ Points Cl√©s du Flux</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; text-align: left;">
                <div style="background: white; padding: 20px; border-radius: 10px;">
                    <strong style="color: #e74c3c;">1Ô∏è‚É£ V√©rification imm√©diate</strong>
                    <p style="margin-top: 10px; color: #7f8c8d;">Si mod√®le pr√©-s√©lectionn√©, v√©rifier compatibilit√© dimensions AVANT toutes les autres questions</p>
                </div>
                <div style="background: white; padding: 20px; border-radius: 10px;">
                    <strong style="color: #3498db;">2Ô∏è‚É£ Respect du choix client</strong>
                    <p style="margin-top: 10px; color: #7f8c8d;">Si mod√®le valid√© en √âTAPE 1A-BIS, ne PAS reproposer 3 mod√®les en PHASE 3</p>
                </div>
                <div style="background: white; padding: 20px; border-radius: 10px;">
                    <strong style="color: #2ecc71;">3Ô∏è‚É£ Coh√©rence du type</strong>
                    <p style="margin-top: 10px; color: #7f8c8d;">Alternatives toujours du M√äME TYPE : coffre‚Üícoffre, monobloc‚Üímonobloc</p>
                </div>
                <div style="background: white; padding: 20px; border-radius: 10px;">
                    <strong style="color: #f39c12;">4Ô∏è‚É£ Une seule offre</strong>
                    <p style="margin-top: 10px; color: #7f8c8d;">Afficher uniquement les options choisies par le client, pas 3 offres pr√©-d√©finies</p>
                </div>
            </div>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #34495e; color: white; border-radius: 10px; text-align: center;">
            <p><strong>üìÖ Derni√®re mise √† jour :</strong> 15 f√©vrier 2026</p>
            <p style="margin-top: 10px; opacity: 0.8;">Ce diagramme refl√®te la logique compl√®te du prompt du chatbot Storal</p>
        </div>
    </div>
</body>
</html>